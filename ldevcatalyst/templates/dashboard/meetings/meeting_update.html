{% extends 'dashboard/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block breadcrums %}
<!--begin::Breadcrumb-->
<ul class="breadcrumb breadcrumb-separatorless fw-semibold">
    <!--begin::Item-->
    <li class="breadcrumb-item text-white fw-bold lh-1">
        <a href="{% url 'dashboard_index' %}" class="text-white text-hover-primary">
            <i class="ki-outline ki-home text-gray-700 fs-6"></i>
        </a>
    </li>
    <!--end::Item-->
    <!--begin::Item-->
    <li class="breadcrumb-item">
        <i class="ki-outline ki-right fs-7 text-gray-700 mx-n1"></i>
    </li>
    <!--end::Item-->
    <!--begin::Item-->
    <li class="breadcrumb-item text-white fw-bold lh-1">Meetings</li>
    <!--end::Item-->
    <!--begin::Item-->
    <li class="breadcrumb-item">
        <i class="ki-outline ki-right fs-7 text-gray-700 mx-n1"></i>
    </li>
    <!--end::Item-->
    <!--begin::Item-->
    <li class="breadcrumb-item text-white fw-bold lh-1">Update</li>
    <!--end::Item-->
</ul>
<!--end::Breadcrumb-->
{% endblock  %}

{% block pageheading %}
Meetings
{% endblock  %}

{% block pagedescription %}
Update
{% endblock  %}

{% block page_content %}
<div class="d-flex flex-column flex-column-fluid">
    <!--begin::Content-->
    <div id="kt_app_content" class="app-content flex-column-fluid">
        <!--begin::Contacts App- View Contact-->
        <div class="row g-7 justify-content-center">
            <!--begin::Contact groups-->
            <div class="col-lg-6 col-xl-6">
                <!--begin::Contact group wrapper-->
                <div class="card card-flush">
                    <!--begin::Card header-->
                    <div class="card-header pt-7" id="kt_chat_contacts_header">
                        <!--begin::Card title-->
                        <div class="card-title">
                            <h2>
                                {% if user.user_role == 8 %}
                                        {% if meeting_request.status == 'start_up_request' %}
                                                    Please add meeting details
                                        {% else %}
                                                    Meeting details
                                        {% endif %}
                                {% else %}
                                    Meeting details update
                                {% endif %}
                            </h2>
                        </div>
                        
                        <!--end::Card title-->
                    </div>
                    <!--end::Card header-->
                    <!--begin::Card body-->
                    <div class="card-body">
                        <div class="mt-3">
                            <form id="meetingForm" method="post" class="needs-validation" novalidate>
                                {% csrf_token %}
                                {% crispy form %}
                                <button type="submit" class="btn btn-primary">Update meeting request</button>
                            </form>
                        </div>
                        <div class="mt-3">
                            <button onclick="goBack()" class="btn btn-secondary">
                                <i class="bi bi-arrow-left me-2"></i>Go Back
                            </button>
                        </div>
                    </div>
                </div>
                <!--end::Contact group wrapper-->
            </div>
            <!--end::Contact groups-->
        </div>
        <!--end::Contacts App- View Contact-->
    </div>
    <!--end::Content-->
</div>
<!--end::Content wrapper-->
<!--begin::Footer-->
{% endblock %}

{% block custom_js %}
<!-- Include necessary JavaScript libraries and initialize them -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/css/bootstrap-datepicker.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap-datepicker@1.9.0/dist/js/bootstrap-datepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-timepicker/0.5.2/js/bootstrap-timepicker.min.js"></script>

<script>
    $(document).ready(function () {
        // Initialize Datepicker
        $('#id_meeting_date').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayHighlight: true
        });

        // Initialize Timepicker
        $('#id_meeting_time').timepicker({
            showMeridian: false,
            minuteStep: 1
        });


        $('#div_id_status').closest('.mb-3').hide();

        {% comment %} if (user.user_role == 6 || user.user_role == 8) {
            $('#id_meeting_type').change(function () {
                var meetingType = $(this).val();
                if (meetingType === 'offline') {
                    $('#div_id_meeting_location').closest('.mb-3').show();
                } else {
                    $('#div_id_meeting_location').closest('.mb-3').hide();
                }
            }).change();
        } {% endcomment %}

        // Hide or show fields based on meeting type and initial status
        $('#id_status').change(function () {
            var initialStatus = $(this).val();
            var meetingType = $('#id_meeting_type').val();

            if (initialStatus === 'start_up_request') {
                // Enable fields for update
                $('#id_meeting_type, #id_meeting_date, #id_meeting_time').prop('disabled', true);
                
            } else {
                // Disable all fields except for meeting type and hide meeting location
                $('#id_meeting_type, #id_meeting_date, #id_meeting_time').prop('disabled', false);
                $('#div_id_meeting_location').closest('.mb-3').hide();
            }
        }).change(); // Trigger initial change event
    
    });            
</script>
{% endblock %}
